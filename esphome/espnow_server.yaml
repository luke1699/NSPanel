substitutions:
##### Change MAC ADDRESS Sensors ###########
  nome_stanza1: "Stanza 1"
  temperatura_sensore1: "Temperatura Nodo 1"
  umidita_sensore1: "Umidità Nodo 1"
  nome_stanza2: "Stanza 2"
  temperatura_sensore2: "Temperatura Nodo 2"
  umidita_sensore2: "Umidità Nodo 2"
  nome_stanza3: "Stanza 3"
  temperatura_sensore3: "Temperatura Nodo 3"
  umidita_sensore3: "Umidità Nodo 3"
  nome_stanza4: "Stanza 4"
  temperatura_sensore4: "Temperatura Nodo 4"
  umidita_sensore4: "Umidità Nodo 4"
  nome_stanza5: "Stanza 5"
  temperatura_sensore5: "Temperatura Nodo 5"
  umidita_sensore5: "Umidità Nodo 5"
  nome_stanza6: "Stanza 6"
  temperatura_sensore6: "Temperatura Nodo 6"
  umidita_sensore6: "Umidità Nodo 6"
  nome_stanza7: "Stanza 7"
  temperatura_sensore7: "Temperatura Nodo 7"
  umidita_sensore7: "Umidità Nodo 7"
  nome_stanza8: "Stanza 8"
  temperatura_sensore8: "Temperatura Nodo 8"
  umidita_sensore8: "Umidità Nodo 8"

######## Settings Relè ############
  Rele_name_1: "Relè 1"
  Rele_name_2: "Relè 2"
  Rele_name_3: "Relè 3"
  Rele_name_4: "Relè 4"
  Rele_name_5: "Relè 5"
  Rele__name_6: "Relè 6"
  Rele_name_7: "Relè 7"
  Rele_name_8: "Relè 8"

beethowen_receiver:
  devices:
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza1}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza2}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza3}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza4}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza5}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza6}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza7}"
    - mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS
      name_prefix: "&{nome_stanza8}"

sensor:
  - platform: homeassistant
    id: temperature_sensor
    entity_id: sensor.stanza_temperatura
  - platform: template
    id: tempmedium
    name: "Temperatura Media ${name_1}"
    lambda: return ((id(temperature_1).state + id(temperature_2) + id(temperature_3) + id(temperature_4) + id(temperature_5) + id(temperature_6) + id(temperature_7) + id(temperature_8) /8);
    update_interval: 10s
    device_class: "temperature"
    state_class: "measurement"
    accuracy_decimals: 1
    unit_of_measurement: "°C"
  ########### configurazione nodo 1 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 1
    sensors:
    - measurement_type: 0x02
      id: temperature_1
      name: "&{temperatura_sensore1}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore1}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 2 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 2
    sensors:
    - measurement_type: 0x02
      id: temperature_2
      name: "&{temperatura_sensore2}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore2}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 3 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 3
    sensors:
    - measurement_type: 0x02
      id: temperature_3
      name: "&{temperatura_sensore3}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore3}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 4 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 4
    sensors:
    - measurement_type: 0x02
      id: temperature_4
      name: "&{temperatura_sensore4}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore4}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 5 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 5
    sensors:
    - measurement_type: 0x02
      id: temperature_5
      name: "&{temperatura_sensore5}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore5}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 6 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 6
    sensors:
    - measurement_type: 0x02
      id: temperature_6
      name: "&{temperatura_sensore6}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore6}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 7 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 7
    sensors:
    - measurement_type: 0x02
      id: temperature_7
      name: "&{temperatura_sensore7}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore7}"
      accuracy_decimals: 0
      unit_of_measurement: "%"
  ########### configurazione nodo 8 sensori #################
  - platform: beethowen_receiver
    mac_address: FF:FF:FF:FF:FF:FF #change MAC ADDRESS Node 8
    sensors:
    - measurement_type: 0x02
      id: temperature_8
      name: "&{temperatura_sensore8}"
      accuracy_decimals: 2
      unit_of_measurement: "°C"
    - measurement_type: 0x03
      name: "&{umidita_sensore8}"
      accuracy_decimals: 0
      unit_of_measurement: "%"

binary_sensor:
  - platform: template
    name: "Stato Riscaldamento"
    id: stato_riscaldamento
    device_class: heat
    lambda: |-
      if ((id(thermostat_1).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_2).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_3).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_4).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_5).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_6).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_7).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT) || (id(thermostat_8).mode == esphome::climate::ClimateMode::CLIMATE_MODE_HEAT)) {
        return true;
      } else {
        return false;
      }
    on_state:
      then:
        - if:
            condition:
              binary_sensor.is_on: stato_riscaldamento
            then:
              - switch.turn_on: relay_heat
            else:
              - switch.turn_off: relay_heat
  - platform: template
    name: "Stato Raffrescamento"
    id: stato_raffrescamento
    device_class: cold
    lambda: |-
      if ((id(thermostat_1).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_2).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_3).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_4).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_5).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_6).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_7).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL) || (id(thermostat_8).mode == esphome::climate::ClimateMode::CLIMATE_MODE_COOL)) {
        return true;
      } else {
        return false;
      }
    on_state:
      then:
        - if:
            condition:
              binary_sensor.is_on: stato_raffrescamento
            then:
              - switch.turn_on: relay_cool
            else:
              - switch.turn_off: relay_cool

climate:
  - platform: thermostat
    name: "Termostato 1"
    id: thermostat_1
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_1
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay
    idle_action: 
      - switch.turn_off: relay
    cool_action:
      - switch.turn_on: relay
      - switch.turn_on: relay_cool
      - switch.turn_off: relay_heat
    heat_action:
      - switch.turn_on: relay
      - switch.turn_on: relay_heat
      - switch.turn_off: relay_cool
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 2"
    id: thermostat_2
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_2
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_2
    idle_action: 
      - switch.turn_off: relay_2
    cool_action:
      - switch.turn_on: relay_2
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_2
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 3"
    id: thermostat_3
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_3
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_3
    idle_action: 
      - switch.turn_off: relay_3
    cool_action:
      - switch.turn_on: relay_3
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_3
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 4"
    id: thermostat_4
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_4
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_4
    idle_action: 
      - switch.turn_off: relay_4
    cool_action:
      - switch.turn_on: relay_4
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_4
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 5"
    id: thermostat_5
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_5
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_5
    idle_action: 
      - switch.turn_off: relay_5
    cool_action:
      - switch.turn_on: relay_5
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_5
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 6"
    id: thermostat_6
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_6
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_6
    idle_action: 
      - switch.turn_off: relay_6
    cool_action:
      - switch.turn_on: relay_6
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_6
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 7"
    id: thermostat_7
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_7
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_7
    idle_action: 
      - switch.turn_off: relay_7
    cool_action:
      - switch.turn_on: relay_7
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_7
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25
  
  - platform: thermostat
    name: "Termostato 8"
    id: thermostat_8
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    sensor: temperature_8
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay_8
    idle_action: 
      - switch.turn_off: relay_8
    cool_action:
      - switch.turn_on: relay_8
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
    heat_action:
      - switch.turn_on: relay_8
      - switch.turn_off: relay_cool
      - switch.turn_on: relay_heat
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25

  - platform: thermostat
    name: "Termostato All"
    id: thermostat_all
    visual:
      min_temperature: 18
      max_temperature: 30
      temperature_step: 0.5    
    min_heating_run_time: 300s
    min_heating_off_time: 300s
    min_cooling_off_time: 300s
    min_cooling_run_time: 300s
    min_idle_time: 30s
    off_mode: 
      - switch.turn_off: relay
      - switch.turn_off: relay_2
      - switch.turn_off: relay_3
      - switch.turn_off: relay_4
      - switch.turn_off: relay_5
      - switch.turn_off: relay_6
      - switch.turn_off: relay_7
      - switch.turn_off: relay_8
      - switch.turn_off: relay_heat
      - switch.turn_off: relay_cool
    idle_action:
      - switch.turn_off: relay
      - switch.turn_off: relay_2
      - switch.turn_off: relay_3
      - switch.turn_off: relay_4
      - switch.turn_off: relay_5
      - switch.turn_off: relay_6
      - switch.turn_off: relay_7
      - switch.turn_off: relay_8
      - switch.turn_off: relay_heat
      - switch.turn_off: relay_cool
    cool_action:
      - switch.turn_on: relay
      - switch.turn_on: relay_2
      - switch.turn_on: relay_3
      - switch.turn_on: relay_4
      - switch.turn_on: relay_5
      - switch.turn_on: relay_6
      - switch.turn_on: relay_7
      - switch.turn_on: relay_8
      - switch.turn_off: relay_heat
      - switch.turn_on: relay_cool
      - climate.control: 
          id: thermostat_1
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_2
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_3
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_4
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_5
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_6
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_7
          mode: COOL
          target_temperature: 25
      - climate.control: 
          id: thermostat_8
          mode: COOL
          target_temperature: 25
    heat_action:
      - switch.turn_on: relay
      - switch.turn_on: relay_2
      - switch.turn_on: relay_heat
      - switch.turn_off: relay_cool
      - climate.control: 
          id: thermostat_1
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_2
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_3
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_4
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_5
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_6
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_7
          mode: HEAT
          target_temperature: 21
      - climate.control: 
          id: thermostat_8
          mode: HEAT
          target_temperature: 21
    sensor: tempmedium
    preset:
      - name: Fuori Casa
        default_target_temperature_low: 18
        default_target_temperature_high: 27
      - name: Notturno
        default_target_temperature_low: 18
        default_target_temperature_high: 25
      - name: A Casa
        default_target_temperature_low: 21
        default_target_temperature_high: 25

switch:
  - platform: gpio
    pin: GPIO15
    name: "&{Rele_name_1}"
    id: relay
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO16
    name: "&{Rele_name_2}"
    id: relay_2
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO17
    name: "&{Rele_name_3}"
    id: relay_3
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO18
    name: "&{Rele_name_4}"
    id: relay_4
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO19
    name: "&{Rele_name_5}"
    id: relay_5
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO26
    name: "&{Rele_name_6}"
    id: relay_6
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO27
    name: "&{Rele_name_7}"
    id: relay_7
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO32
    name: "&{Rele_name_8}"
    id: relay_8
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO12
    name: "Relay Heat"
    id: relay_heat
    restore_mode: ALWAYS_OFF
  - platform: gpio
    pin: GPIO13
    name: "Relay Cool"
    id: relay_cool
    restore_mode: ALWAYS_OFF
